{# templates/public_form.html #}
<!DOCTYPE html>
{# ... (head section with CSS links remains same) ... #}
<body>
    <div class="form-container pt-4 pb-5"> {# Added more padding #}
        <h2 class="mb-3">{{ form.title }}</h2> {# Reduced margin #}
        {% if form.description %}
            <p class="lead text-muted mb-4">{{ form.description }}</p> {# Increased margin #}
        {% endif %}
        {# Removed <hr> #}

        {% with messages = get_flashed_messages(with_categories=true) %} {# Flash messages #}
          {# ... (flash message loop as before) ... #}
        {% endwith %}

        <form method="POST" action="" class="mt-4"> {# Added margin #}
             <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            {% for field in fields %}
                {% set field_name = 'field_' + field.id|string %}
                <div class="mb-4"> {# Increased margin #}
                    <label for="{{ field_name }}" class="form-label fw-medium"> {# Bolder label #}
                        {{ field.label }}
                        {% if field.required %}<span class="text-danger ms-1">*</span>{% endif %} {# Added margin #}
                    </label>

                    {% set has_error = errors.get(field_name) %}
                    {% set input_class = 'form-control' if field.field_type not in ['checkbox', 'radio', 'select'] else ('form-check-input' if field.field_type == 'checkbox' else ('form-check-input' if field.field_type == 'radio' else 'form-select')) %}
                    {% if has_error %}{% set input_class = input_class + ' is-invalid' %}{% endif %}

                    {# --- Render input types --- #}
                    {% if field.field_type in ['text', 'email', 'number', 'date'] %}
                        <input type="{{ field.field_type }}" class="{{ input_class }}" id="{{ field_name }}" name="{{ field_name }}" value="{{ submitted_data.get(field_name, '') }}" {% if field.required %}required{% endif %}>
                    {% elif field.field_type == 'textarea' %}
                        <textarea class="{{ input_class }}" id="{{ field_name }}" name="{{ field_name }}" rows="4" {% if field.required %}required{% endif %}>{{ submitted_data.get(field_name, '') }}</textarea> {# Larger rows #}
                    {% elif field.field_type == 'checkbox' %}
                        <div class="form-check pt-1"> {# Add padding #}
                            <input class="{{ input_class }}" type="checkbox" value="true" id="{{ field_name }}" name="{{ field_name }}" {% if submitted_data.get(field_name) == 'true' %}checked{% endif %} {% if field.required %}required{% endif %}>
                            {# Label moved beside checkbox for better alignment #}
                            {# <label class="form-check-label" for="{{ field_name }}"> {{ field.label }} {% if field.required %}<span class="text-danger ms-1">*</span>{% endif %}</label> #}
                             <label class="form-check-label" for="{{ field_name }}"> Confirm/Agree </label> {# Generic label for checkbox itself #}
                             {% if has_error %} {# Error specific to checkbox #}
                                <div class="invalid-feedback d-block"> {# Force display #}
                                    {{ errors[field_name] }}
                                </div>
                             {% endif %}
                        </div>
                    {% elif field.field_type == 'select' %}
                        <select class="{{ input_class }}" id="{{ field_name }}" name="{{ field_name }}" {% if field.required %}required{% endif %}>
                            <option value="" {% if not submitted_data.get(field_name) %}selected{% endif %} disabled>-- Please select --</option>
                            {% set options_list = field.options.split(',') %}
                            {% for option in options_list %}{% set opt_val = option.strip() %}<option value="{{ opt_val }}" {% if submitted_data.get(field_name) == opt_val %}selected{% endif %}>{{ opt_val }}</option>{% endfor %}
                        </select>
                    {% elif field.field_type == 'radio' %}
                        {# Add padding to first radio #}
                        {% set options_list = field.options.split(',') %}
                        {% for option in options_list %}
                            {% set opt_val = option.strip() %}
                            {% set radio_id = field_name + '_' + loop.index|string %}
                            <div class="form-check {% if loop.first %}pt-1{% endif %} {% if has_error %}is-invalid{% endif %}"> {# Add is-invalid marker to group #}
                                <input class="form-check-input {{ 'is-invalid' if has_error else '' }}" type="radio" id="{{ radio_id }}" name="{{ field_name }}" value="{{ opt_val }}" {% if submitted_data.get(field_name) == opt_val %}checked{% endif %} {% if field.required %}required{% endif %}>
                                <label class="form-check-label" for="{{ radio_id }}">{{ opt_val }}</label>
                            </div>
                        {% endfor %}
                        {# Display error once after radios if needed #}
                         {% if has_error %}
                            <div class="invalid-feedback d-block"> {# Force display #}
                                {{ errors[field_name] }}
                            </div>
                         {% endif %}
                    {% else %}
                        <input type="text" class="form-control is-disabled" id="{{ field_name }}" name="{{ field_name }}" disabled value="Unsupported field type: {{ field.field_type }}">
                    {% endif %}

                    {# --- Display Validation Error (handled inside radio/checkbox blocks now) --- #}
                    {% if has_error and field.field_type not in ['radio', 'checkbox'] %}
                        <div class="invalid-feedback">
                            {{ errors[field_name] }}
                        </div>
                    {% endif %}

                </div> {# End mb-4 #}
            {% endfor %} {# End field loop #}

            <div class="d-grid mt-4"> {# Use d-grid for full width button #}
                 <button class="btn btn-primary btn-lg" type="submit">Submit</button> {# Larger button #}
            </div>
        </form>

    </div> {# End form-container #}
    {# ... (scripts remain same) ... #}
</body>
</html>
